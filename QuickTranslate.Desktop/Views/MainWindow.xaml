<ui:FluentWindow x:Class="QuickTranslate.Desktop.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:QuickTranslate.Desktop.Services"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="QuickTranslate" 
        Height="600" 
        Width="700"
        MinHeight="450"
        MinWidth="550"
        WindowStartupLocation="CenterScreen"
        Background="{ui:ThemeResource ApplicationBackgroundBrush}"
        Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        PreviewKeyDown="Window_PreviewKeyDown"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        Icon="pack://application:,,,/icon.ico">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <ui:TitleBar Grid.Row="0" 
                    Title="QuickTranslate"
                    ShowMaximize="True"
                    ShowMinimize="True"/>
        
        <Grid Grid.Row="1" Margin="16,8,16,16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Language Selection -->
        <ui:Card Grid.Row="0" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Source Language (Auto-detect) -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="Document24" 
                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                   Margin="0,0,8,0"/>
                    <StackPanel>
                        <TextBlock Text="{Binding [Source], Source={x:Static local:Loc.Instance}}" 
                                   FontSize="11" 
                                   Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                        <TextBlock Text="{Binding [AutoDetect], Source={x:Static local:Loc.Instance}}" 
                                   FontSize="14" 
                                   FontWeight="SemiBold"
                                   Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- Swap Button -->
                <ui:Button Grid.Column="1" 
                           Appearance="Transparent"
                           ToolTip="{Binding [SwapSourceAndTranslation], Source={x:Static local:Loc.Instance}}"
                           Command="{Binding SwapTextsCommand}"
                           Margin="16,0">
                    <ui:SymbolIcon Symbol="ArrowSwap24" FontSize="18"/>
                </ui:Button>
                
                <!-- Target Language -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="LocalLanguage24" 
                                   Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"
                                   Margin="0,0,8,0"/>
                    <StackPanel>
                        <TextBlock Text="{Binding [TranslateTo], Source={x:Static local:Loc.Instance}}" 
                                   FontSize="11" 
                                   Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                        <ComboBox ItemsSource="{Binding AvailableLanguages}"
                                  Text="{Binding SelectedTargetLanguage, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                  IsEditable="True"
                                  Width="120"
                                  Padding="8,4"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- Settings Button -->
                <ui:Button Grid.Column="3" 
                           Appearance="Transparent"
                           Click="Settings_Click"
                           ToolTip="{Binding [Settings], Source={x:Static local:Loc.Instance}}"
                           Margin="8,0,0,0">
                    <ui:SymbolIcon Symbol="Settings24"/>
                </ui:Button>
            </Grid>
        </ui:Card>
        
        
            <!-- Source Text Card -->
        <ui:Card Grid.Row="1" Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Edit24" 
                                       Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding [SourceText], Source={x:Static local:Loc.Instance}}" 
                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" 
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Profile Selection -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <!-- Auto Toggle -->
                        <ToggleButton IsChecked="{Binding UseAutoProfileDetection, Mode=TwoWay}"
                                      ToolTip="{Binding [AutoDetectProfileTooltip], Source={x:Static local:Loc.Instance}}"
                                      Padding="8,4"
                                      Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Sparkle24" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="{Binding [AutoDetectProfile], Source={x:Static local:Loc.Instance}}" 
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </ToggleButton>
                        
                        <!-- Manual Profile Selection -->
                        <ui:SymbolIcon Symbol="BookOpen24" 
                                       Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                       FontSize="14"
                                       Margin="0,0,6,0"
                                       Visibility="{Binding UseAutoProfileDetection, Converter={StaticResource InverseBoolToVis}}"/>
                        <ComboBox ItemsSource="{Binding TranslationProfiles}"
                                  SelectedItem="{Binding SelectedProfile, Mode=TwoWay}"
                                  MinWidth="160"
                                  Padding="8,4"
                                  Visibility="{Binding UseAutoProfileDetection, Converter={StaticResource InverseBoolToVis}}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource ProfileNameConverter}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <ui:Button Appearance="Transparent" 
                                   Command="{Binding PasteCommand}"
                                   ToolTip="{Binding [PasteFromClipboard], Source={x:Static local:Loc.Instance}}"
                                   Padding="6,4">
                            <ui:SymbolIcon Symbol="ClipboardPaste24" FontSize="14"/>
                        </ui:Button>
                    </StackPanel>
                </Grid>
                
                <!-- Text Input -->
                <TextBox Grid.Row="1" 
                         x:Name="SourceTextBox"
                         Text="{Binding SourceText, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         FontSize="14"
                         MinHeight="100"
                         Padding="12"/>
                
                <!-- Character Count -->
                <TextBlock Grid.Row="2" 
                           Text="{Binding SourceCharacterCountText}"
                           Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                           FontSize="11"
                           HorizontalAlignment="Right"
                           Margin="0,6,0,0"/>
            </Grid>
        </ui:Card>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Center" 
                    Margin="0,12">
            <ui:Button Command="{Binding TranslateCommand}"
                       Appearance="Primary"
                       IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                       Width="140"
                       Height="36">
                <StackPanel Orientation="Horizontal">
                    <ui:SymbolIcon Symbol="Play24" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding [Translate], Source={x:Static local:Loc.Instance}}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                </StackPanel>
            </ui:Button>
            <ui:Button Command="{Binding CancelCommand}"
                       Appearance="Secondary"
                       Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                       Margin="8,0,0,0"
                       Height="36">
                <StackPanel Orientation="Horizontal">
                    <ui:SymbolIcon Symbol="Dismiss24" Margin="0,0,6,0"/>
                    <TextBlock Text="{Binding [Cancel], Source={x:Static local:Loc.Instance}}" VerticalAlignment="Center"/>
                </StackPanel>
            </ui:Button>
        </StackPanel>

        <!-- Translation Result Card -->
        <ui:Card Grid.Row="3" Margin="0,8,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Translate24" 
                                       Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"
                                       Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding [Translation], Source={x:Static local:Loc.Instance}}" 
                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" 
                                   FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding SelectedTargetLanguage, StringFormat=' ({0})'}"
                                   Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <ui:Button Appearance="Transparent" 
                                   Command="{Binding SpeakTranslationCommand}"
                                   ToolTip="{Binding [SpeakTranslation], Source={x:Static local:Loc.Instance}}"
                                   Padding="6,4"
                                   Visibility="{Binding CanSpeak, Converter={StaticResource BoolToVis}}">
                            <ui:SymbolIcon Symbol="Speaker224" FontSize="14"
                                           Foreground="{Binding IsSpeaking, Converter={StaticResource SpeakingColorConverter}}"/>
                        </ui:Button>
                        <ui:Button Appearance="Transparent" 
                                   Command="{Binding CopyTranslationCommand}"
                                   ToolTip="{Binding [CopyToClipboard], Source={x:Static local:Loc.Instance}}"
                                   Padding="6,4">
                            <ui:SymbolIcon Symbol="Copy24" FontSize="14"/>
                        </ui:Button>
                    </StackPanel>
                </Grid>
                
                <!-- Translation Output -->
                <Grid Grid.Row="1">
                    <TextBox Text="{Binding TranslatedText, Mode=OneWay}"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             FontSize="14"
                             MinHeight="100"
                             Padding="12"/>
                    
                    <!-- Loading Overlay -->
                    <Border Background="{ui:ThemeResource ControlOnImageFillColorDefaultBrush}" 
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                            CornerRadius="4">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <ui:ProgressRing IsIndeterminate="{Binding IsLoading}" 
                                           Width="40" 
                                           Height="40"/>
                            <TextBlock Text="{Binding [Translating], Source={x:Static local:Loc.Instance}}" 
                                       Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                       FontSize="13"
                                       Margin="0,12,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
                
                <!-- Character Count -->
                <TextBlock Grid.Row="2" 
                           Text="{Binding TranslatedCharacterCountText}"
                           Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                           FontSize="11"
                           HorizontalAlignment="Right"
                           Margin="0,6,0,0"/>
            </Grid>
        </ui:Card>

        <!-- Footer Status Bar -->
        <Grid Grid.Row="4" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Provider Info -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <ui:SymbolIcon Symbol="Bot24" 
                               Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                               FontSize="14"
                               Margin="0,0,6,0"/>
                <TextBlock Text="{Binding SelectedProvider.Name, FallbackValue='No provider'}"
                           Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                           FontSize="12"
                           VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Status Message -->
            <TextBlock Grid.Column="1"
                       Text="{Binding StatusMessage}" 
                       Foreground="{Binding HasError, Converter={StaticResource ErrorColorConverter}}"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       TextTrimming="CharacterEllipsis"
                       FontSize="12"/>
            
            <!-- Action Buttons -->
            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <ui:Button Command="{Binding ClearCommand}"
                           Appearance="Transparent"
                                   ToolTip="{Binding [ClearAll], Source={x:Static local:Loc.Instance}}"
                           Padding="8,6">
                    <ui:SymbolIcon Symbol="Delete24" FontSize="16"/>
                </ui:Button>
            </StackPanel>
        </Grid>
        </Grid>
        
        <!-- System Tray Icon -->
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="QuickTranslate"
                        DoubleClickCommand="{Binding ShowWindowCommand}"
                        Visibility="Visible">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="{Binding [Show], Source={x:Static local:Loc.Instance}}" Click="TrayShow_Click"/>
                    <MenuItem Header="{Binding [Settings], Source={x:Static local:Loc.Instance}}" Click="TraySettings_Click"/>
                    <Separator/>
                    <MenuItem Header="{Binding [Exit], Source={x:Static local:Loc.Instance}}" Click="TrayExit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Grid>
</ui:FluentWindow>
